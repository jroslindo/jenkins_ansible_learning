---
- name: Configure Server
  hosts: server
  tasks:
    - name: Clone the repo
      git:
        repo: https://github.com/jroslindo/jenkins_ansible_learning
        dest: /my_application
      become: yes

    - name: Install packages using poetry
      command: $HOME/.local/bin/poetry install --no-root
      args:
        chdir: /my_application/server
      become: yes

    - name: Stop the Flask application
      become: yes
      command: pkill -f "python3"

    - name: Start my application in port 3000
      become: yes
      command: nohup $HOME/.local/bin/poetry run python3 __main__.py > /dev/null 2>&1 &